/*!
 * @copyright@
 */
jQuery.sap.require("jquery.sap.storage");sap.ui.controller("sap.ui.demokit.explored.view.master",{_bIsViewUpdatedAtLeastOnce:false,_oVSDialog:null,_oViewSettings:null,_oStorage:jQuery.sap.storage(jQuery.sap.storage.Type.local),_sStorageKey:"UI5_EXPLORED_VIEW_SETTINGS",_mGroupFunctions:{"name":function(c){var k=c.getProperty("name").charAt(0);return{key:k,text:k}},"namespace":true,"category":true,"appComponent":true,"since":true,"formFactors":true},onInit:function(){this.router=sap.ui.core.UIComponent.getRouterFor(this);this.router.attachRoutePatternMatched(this.onRouteMatched,this);this._component=sap.ui.core.Component.getOwnerComponentFor(this.getView());this._component.getEventBus().subscribe("app","selectEntity",this.onSelectEntity,this);this.getView().addEventDelegate({onBeforeFirstShow:jQuery.proxy(this.onBeforeFirstShow,this)})},onBeforeFirstShow:function(){if(!this._bIsViewUpdatedAtLeastOnce){this._updateView()}},onRouteMatched:function(e){var r=e.getParameter("name");if(r!=="home"&&r!="notFound"){return}this._updateView()},onOpenAppSettings:function(e){if(!this._oSettingsDialog){this._oSettingsDialog=new sap.ui.xmlfragment("sap.ui.demokit.explored.view.appSettingsDialog",this);this.getView().addDependent(this._oSettingsDialog)}var c=e.getSource();jQuery.sap.delayedCall(0,this,function(){var a=sap.ui.getCore().getConfiguration();var C=(this._oViewSettings.compactOn)?"compactOn":"compactOff";sap.ui.getCore().byId("ThemeButtons").setSelectedButton(a.getTheme());sap.ui.getCore().byId("CompactModeButtons").setSelectedButton(C);this._oSettingsDialog.open()},c)},onSaveAppSettings:function(e){this._oSettingsDialog.close();if(!this._oBusyDialog){jQuery.sap.require("sap.m.BusyDialog");this._oBusyDialog=new sap.m.BusyDialog();this.getView().addDependent(this._oBusyDialog)}var c=(sap.ui.getCore().byId('CompactModeButtons').getSelectedButton()==="compactOn")?true:false;var t=sap.ui.getCore().byId('ThemeButtons').getSelectedButton();this._oBusyDialog.open();jQuery.sap.delayedCall(1000,this,function(){this._oBusyDialog.close()});this._oViewSettings.compactOn=c;this._oViewSettings.themeActive=t;var s=JSON.stringify(this._oViewSettings);this._oStorage.put(this._sStorageKey,s);this._component.getEventBus().publish("app","applyAppConfiguration",{themeActive:t,compactOn:c})},onDialogCloseButton:function(){this._oSettingsDialog.close()},onSelectEntity:function(c,e,d){var v=this.getView(),l=v.byId("list"),m=v.getModel("entity");var s=null;var I=l.getItems();jQuery.each(I,function(i,o){var C=o.getBindingContext("entity");if(C){var p=C.getPath();var E=m.getProperty(p);if(E.id===d.id){s=o;return false}}});if(s){l.setSelectedItem(s)}else{l.removeSelections()}},onOpenViewSettings:function(){if(!this._oVSDialog){this._oVSDialog=sap.ui.xmlfragment("sap.ui.demokit.explored.view.viewSettingsDialog",this);this.getView().addDependent(this._oVSDialog)}jQuery.sap.delayedCall(0,this,function(){var f={};jQuery.each(this._oViewSettings.filter,function(p,v){jQuery.each(v,function(i,V){f[V]=true})});this._oVSDialog.setSelectedFilterKeys(f);this._oVSDialog.setSelectedGroupItem(this._oViewSettings.groupProperty);this._oVSDialog.setGroupDescending(this._oViewSettings.groupDescending);this._oVSDialog.toggleStyleClass("sapUiSizeCompact",this._oViewSettings.compactOn);this._oVSDialog.open()})},onConfirmViewSettings:function(e){var t=this;this._oViewSettings.filter={};var f=e.getParameter("filterItems");jQuery.each(f,function(i,I){var k=I.getKey();var p=I.getParent().getKey();if(!t._oViewSettings.filter.hasOwnProperty(p)){t._oViewSettings.filter[p]=[]}t._oViewSettings.filter[p].push(k)});var g=e.getParameter("groupItem");var n=(g)?g.getKey():null;this._oViewSettings.groupProperty=n;this._oViewSettings.groupDescending=e.getParameter("groupDescending");var s=JSON.stringify(this._oViewSettings);this._oStorage.put(this._sStorageKey,s);this._updateView()},onSearch:function(){this._updateView()},onNavToEntity:function(e){var i=e.getParameter("listItem");var I=(i)?i:e.getSource();var p=I.getBindingContext("entity").getPath();var E=this.getView().getModel("entity").getProperty(p);var r=!sap.ui.Device.system.phone;this.router.navTo("entity",{id:E.id,part:"samples"},r)},_updateView:function(){if(!this._oViewSettings){this._initViewSettings();this._component.getEventBus().publish("app","applyAppConfiguration",{themeActive:this._oViewSettings.themeActive,compactOn:this._oViewSettings.compactOn})}this._updateFilterBarDisplay();this._updateListBinding()},_updateFilterBarDisplay:function(){var f="";jQuery.each(this._oViewSettings.filter,function(p,V){jQuery.each(V,function(i,a){f+=a+", "})});if(f.length>0){var I=f.lastIndexOf(", ");f=f.substring(0,I)}var v=this.getView();v.byId("vsFilterBar").setVisible(f.length>0);v.byId("vsFilterLabel").setText(f)},_updateListBinding:function(){var f=[],s=[],S=this.getView().byId("searchField"),l=this.getView().byId("list"),b=l.getBinding("items");var q=S.getValue();if(q){f.push(new sap.ui.model.Filter("searchTags","Contains",q))}jQuery.each(this._oViewSettings.filter,function(p,v){var P=[];jQuery.each(v,function(i,V){var O=(p==="formFactors")?"Contains":"EQ";P.push(new sap.ui.model.Filter(p,O,V))});var F=new sap.ui.model.Filter(P,false);f.push(F)});if(f.length===0){b.filter(f,"Application")}else{var F=new sap.ui.model.Filter(f,true);b.filter(F,"Application")}if(this._oViewSettings.groupProperty){var o=new sap.ui.model.Sorter(this._oViewSettings.groupProperty,this._oViewSettings.groupDescending,this._mGroupFunctions[this._oViewSettings.groupProperty]);s.push(o)}s.push(new sap.ui.model.Sorter("name",false));b.sort(s);this._bIsViewUpdatedAtLeastOnce=true},_initViewSettings:function(){var j=this._oStorage.get(this._sStorageKey);if(!j){this._oViewSettings={filter:{},groupProperty:"category",groupDescending:false,compactOn:false,themeActive:"sap_bluecrystal"}}else{this._oViewSettings=JSON.parse(j);var f=this.getView().getModel("filter").getData();var c={};jQuery.each(this._oViewSettings.filter,function(p,v){var n=[];jQuery.each(v,function(i,V){var b=false;jQuery.each(f[p],function(i,o){if(o.id===V){b=true;return false}});if(b){n.push(V)}});if(n.length>0){c[p]=n}});this._oViewSettings.filter=c;if(!this._oViewSettings.hasOwnProperty("compactOn")){this._oViewSettings.compactOn=false}if(!this._oViewSettings.hasOwnProperty("themeActive")){this._oViewSettings.themeActive="sap_bluecrystal"}}},getGroupHeader:function(g){return new sap.m.GroupHeaderListItem({title:g.key,upperCase:false})}});
